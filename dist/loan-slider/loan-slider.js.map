{"version":3,"file":"loan-slider.js","sources":["../../src/blocks/loan-slider/loan-slider.ts"],"sourcesContent":["import { html, render, TemplateResult } from 'lit';\n\nimport { cleanUpBlock } from 'Utils/cleanUpBlock';\nimport { readBlockConfig } from '../../app/tasks/readBlockConfig';\n\nimport './loan-slider.scss';\n\ninterface LoanSliderConfig {\n  min: number;\n  max: number;\n  step: number;\n  initial: number;\n  currency: string;\n  ctaLabel: string;\n  title: string;\n  helper: string;\n}\n\ninterface LoanSliderState {\n  amount: number;\n  pan: string;\n  panTouched: boolean;\n  showResult: boolean;\n}\n\nconst PAN_THRESHOLD = 50000;\nconst PAN_REGEX = /^[A-Z]{5}[0-9]{4}[A-Z]$/;\n\nconst toNumber = (value: string, fallback: number): number => {\n  const parsed = Number(value.replace(/,/g, '').trim());\n  return Number.isFinite(parsed) ? parsed : fallback;\n};\n\nconst clamp = (value: number, min: number, max: number): number => {\n  return Math.min(max, Math.max(min, value));\n};\n\nconst snapToStep = (value: number, min: number, step: number): number => {\n  const stepped = Math.round((value - min) / step) * step + min;\n  return Number.isFinite(stepped) ? stepped : value;\n};\n\nconst formatAmount = (value: number, locale = 'en-IN'): string => {\n  return new Intl.NumberFormat(locale, { maximumFractionDigits: 0 }).format(value);\n};\n\nconst template = (config: LoanSliderConfig, state: LoanSliderState): TemplateResult => {\n  const amountLabel = `${config.currency}${formatAmount(state.amount)}`;\n  const isPanRequired = state.amount > PAN_THRESHOLD;\n  const isPanValid = PAN_REGEX.test(state.pan);\n  const showPanError = isPanRequired && state.panTouched && !isPanValid;\n  const panValue = state.pan;\n\n  if (state.showResult) {\n    return html`<div class=\"loan-slider loan-slider--result\">\n      <div class=\"loan-slider__result\">\n        <h2>${config.title}</h2>\n        <p class=\"loan-slider__result-label\">Your selected loan amount is</p>\n        <div class=\"loan-slider__result-amount\">${amountLabel}</div>\n      </div>\n    </div>`;\n  }\n\n  return html`<div class=\"loan-slider\">\n    <div class=\"loan-slider__header\">\n      <h2>${config.title}</h2>\n      <p>${config.helper}</p>\n    </div>\n    <div class=\"loan-slider__amount\">\n      <label class=\"loan-slider__label\" for=\"loan-slider-input\">Loan amount</label>\n      <div class=\"loan-slider__input-row\">\n        <span class=\"loan-slider__currency\">${config.currency}</span>\n        <input\n          id=\"loan-slider-input\"\n          class=\"loan-slider__number\"\n          type=\"number\"\n          inputmode=\"numeric\"\n          min=\"${config.min}\"\n          max=\"${config.max}\"\n          step=\"${config.step}\"\n          .value=${String(state.amount)}\n          aria-label=\"Loan amount\"\n        />\n      </div>\n      <input\n        class=\"loan-slider__range\"\n        type=\"range\"\n        min=\"${config.min}\"\n        max=\"${config.max}\"\n        step=\"${config.step}\"\n        .value=${String(state.amount)}\n        aria-label=\"Loan amount slider\"\n      />\n      <div class=\"loan-slider__limits\">\n        <span>${config.currency}${formatAmount(config.min)}</span>\n        <span>${config.currency}${formatAmount(config.max)}</span>\n      </div>\n    </div>\n    ${isPanRequired\n      ? html`<div class=\"loan-slider__pan\" role=\"group\" aria-label=\"PAN details\">\n          <div class=\"loan-slider__notice\" role=\"status\">\n            Loans above ${config.currency}${formatAmount(PAN_THRESHOLD)} require PAN details.\n          </div>\n          <label class=\"loan-slider__label\" for=\"loan-slider-pan\">PAN number</label>\n          <input\n            id=\"loan-slider-pan\"\n            class=\"loan-slider__pan-input\"\n            type=\"text\"\n            inputmode=\"text\"\n            maxlength=\"10\"\n            placeholder=\"ABCDE1234F\"\n            .value=${panValue}\n            aria-invalid=${showPanError ? 'true' : 'false'}\n            aria-describedby=\"loan-slider-pan-error\"\n          />\n          <div\n            id=\"loan-slider-pan-error\"\n            class=\"loan-slider__pan-error\"\n            data-visible=${showPanError ? 'true' : 'false'}\n          >\n            Enter a valid PAN in the format ABCDE1234F.\n          </div>\n        </div>`\n      : ''}\n    <button class=\"loan-slider__cta\" type=\"button\" aria-label=\"Submit loan amount\">\n      ${config.ctaLabel}\n    </button>\n  </div>`;\n};\n\nexport default function (block: HTMLElement) {\n  const rawConfig = readBlockConfig(block) as Record<string, string>;\n  const getValue = (keys: string[] | string, fallback: string): string => {\n    const keyList = Array.isArray(keys) ? keys : [keys];\n    for (const key of keyList) {\n      const value = rawConfig[key];\n      if (typeof value === 'string' && value.trim().length) {\n        return value.trim();\n      }\n    }\n    return fallback;\n  };\n\n  const config: LoanSliderConfig = {\n    min: toNumber(getValue('min', '10000'), 10000),\n    max: toNumber(getValue('max', '200000'), 200000),\n    step: toNumber(getValue('step', '1000'), 1000),\n    initial: toNumber(getValue('initial', '50000'), 50000),\n    currency: getValue('currency', 'â‚¹'),\n    ctaLabel: getValue(['ctalabel', 'cta-label'], 'Continue'),\n    title: getValue('title', 'Choose your loan amount'),\n    helper: getValue('helper', 'Use the slider or type an amount.'),\n  };\n\n  config.min = Math.min(config.min, config.max);\n  config.max = Math.max(config.min, config.max);\n  config.step = config.step > 0 ? config.step : 1000;\n\n  const normalizeAmount = (value: number): number => {\n    const snapped = snapToStep(value, config.min, config.step);\n    return clamp(snapped, config.min, config.max);\n  };\n\n  const state: LoanSliderState = {\n    amount: normalizeAmount(config.initial),\n    pan: '',\n    panTouched: false,\n    showResult: false,\n  };\n\n  const update = () => {\n    render(template(config, state), block);\n\n    const amountInput = block.querySelector<HTMLInputElement>('.loan-slider__number');\n    const rangeInput = block.querySelector<HTMLInputElement>('.loan-slider__range');\n    const panInput = block.querySelector<HTMLInputElement>('.loan-slider__pan-input');\n    const ctaButton = block.querySelector<HTMLButtonElement>('.loan-slider__cta');\n\n    if (amountInput) {\n      amountInput.addEventListener('input', (event) => {\n        const target = event.target as HTMLInputElement;\n        const value = Number(target.value);\n        if (!Number.isFinite(value)) return;\n        state.amount = normalizeAmount(value);\n        update();\n      });\n    }\n\n    if (rangeInput) {\n      rangeInput.addEventListener('input', (event) => {\n        const target = event.target as HTMLInputElement;\n        const value = Number(target.value);\n        if (!Number.isFinite(value)) return;\n        state.amount = normalizeAmount(value);\n        update();\n      });\n    }\n\n    if (panInput) {\n      panInput.addEventListener('input', (event) => {\n        const target = event.target as HTMLInputElement;\n        state.pan = target.value.toUpperCase();\n        update();\n      });\n\n      panInput.addEventListener('blur', () => {\n        state.panTouched = true;\n        update();\n      });\n    }\n\n    if (ctaButton) {\n      ctaButton.addEventListener('click', () => {\n        const panRequired = state.amount > PAN_THRESHOLD;\n        const panValid = PAN_REGEX.test(state.pan);\n        if (panRequired && !panValid) {\n          state.panTouched = true;\n          update();\n          return;\n        }\n        state.showResult = true;\n        update();\n      });\n    }\n  };\n\n  cleanUpBlock(block);\n  update();\n}\n"],"names":["PAN_THRESHOLD","PAN_REGEX","toNumber","value","fallback","parsed","clamp","min","max","snapToStep","step","stepped","formatAmount","locale","template","config","state","amountLabel","isPanRequired","isPanValid","showPanError","panValue","html","loanSlider","block","rawConfig","readBlockConfig","getValue","keys","keyList","key","normalizeAmount","snapped","update","render","amountInput","rangeInput","panInput","ctaButton","event","target","panRequired","panValid","cleanUpBlock"],"mappings":"0LAyBA,MAAMA,EAAgB,IAChBC,EAAY,0BAEZC,EAAW,CAACC,EAAeC,IAA6B,CACtD,MAAAC,EAAS,OAAOF,EAAM,QAAQ,KAAM,EAAE,EAAE,MAAM,EACpD,OAAO,OAAO,SAASE,CAAM,EAAIA,EAASD,CAC5C,EAEME,EAAQ,CAACH,EAAeI,EAAaC,IAClC,KAAK,IAAIA,EAAK,KAAK,IAAID,EAAKJ,CAAK,CAAC,EAGrCM,EAAa,CAACN,EAAeI,EAAaG,IAAyB,CACvE,MAAMC,EAAU,KAAK,OAAOR,EAAQI,GAAOG,CAAI,EAAIA,EAAOH,EAC1D,OAAO,OAAO,SAASI,CAAO,EAAIA,EAAUR,CAC9C,EAEMS,EAAe,CAACT,EAAeU,EAAS,UACrC,IAAI,KAAK,aAAaA,EAAQ,CAAE,sBAAuB,EAAG,EAAE,OAAOV,CAAK,EAG3EW,EAAW,CAACC,EAA0BC,IAA2C,CAC/E,MAAAC,EAAc,GAAGF,EAAO,QAAQ,GAAGH,EAAaI,EAAM,MAAM,CAAC,GAC7DE,EAAgBF,EAAM,OAAShB,EAC/BmB,EAAalB,EAAU,KAAKe,EAAM,GAAG,EACrCI,EAAeF,GAAiBF,EAAM,YAAc,CAACG,EACrDE,EAAWL,EAAM,IAEvB,OAAIA,EAAM,WACDM,sFAEGP,EAAO,KAAK,qHAEwBE,CAAW,qBAKpDK,kEAEGP,EAAO,KAAK,WACbA,EAAO,MAAM,mMAKsBA,EAAO,QAAQ,4GAM5CA,EAAO,GAAG,UACVA,EAAO,GAAG,WACTA,EAAO,IAAI,aACV,OAAOC,EAAM,MAAM,CAAC,wFAOxBD,EAAO,GAAG,UACVA,EAAO,GAAG,WACTA,EAAO,IAAI,aACV,OAAOC,EAAM,MAAM,CAAC,4EAIrBD,EAAO,QAAQ,GAAGH,EAAaG,EAAO,GAAG,CAAC,iBAC1CA,EAAO,QAAQ,GAAGH,EAAaG,EAAO,GAAG,CAAC,sBAGpDG,EACEI,mIAEkBP,EAAO,QAAQ,GAAGH,EAAaZ,CAAa,CAAC,iPAUlDqB,CAAQ,mBACFD,EAAe,OAAS,OAAO,2HAM/BA,EAAe,OAAS,OAAO,4DAKlD,EAAE,mFAEFL,EAAO,QAAQ,iBAGvB,EAEA,SAAAQ,EAAyBC,EAAoB,CACrC,MAAAC,EAAYC,EAAgBF,CAAK,EACjCG,EAAW,CAACC,EAAyBxB,IAA6B,CACtE,MAAMyB,EAAU,MAAM,QAAQD,CAAI,EAAIA,EAAO,CAACA,CAAI,EAClD,UAAWE,KAAOD,EAAS,CACnB,MAAA1B,EAAQsB,EAAUK,CAAG,EAC3B,GAAI,OAAO3B,GAAU,UAAYA,EAAM,KAAA,EAAO,OAC5C,OAAOA,EAAM,MAEjB,CACO,OAAAC,CAAA,EAGHW,EAA2B,CAC/B,IAAKb,EAASyB,EAAS,MAAO,OAAO,EAAG,GAAK,EAC7C,IAAKzB,EAASyB,EAAS,MAAO,QAAQ,EAAG,GAAM,EAC/C,KAAMzB,EAASyB,EAAS,OAAQ,MAAM,EAAG,GAAI,EAC7C,QAASzB,EAASyB,EAAS,UAAW,OAAO,EAAG,GAAK,EACrD,SAAUA,EAAS,WAAY,GAAG,EAClC,SAAUA,EAAS,CAAC,WAAY,WAAW,EAAG,UAAU,EACxD,MAAOA,EAAS,QAAS,yBAAyB,EAClD,OAAQA,EAAS,SAAU,mCAAmC,CAAA,EAGhEZ,EAAO,IAAM,KAAK,IAAIA,EAAO,IAAKA,EAAO,GAAG,EAC5CA,EAAO,IAAM,KAAK,IAAIA,EAAO,IAAKA,EAAO,GAAG,EAC5CA,EAAO,KAAOA,EAAO,KAAO,EAAIA,EAAO,KAAO,IAExC,MAAAgB,EAAmB5B,GAA0B,CACjD,MAAM6B,EAAUvB,EAAWN,EAAOY,EAAO,IAAKA,EAAO,IAAI,EACzD,OAAOT,EAAM0B,EAASjB,EAAO,IAAKA,EAAO,GAAG,CAAA,EAGxCC,EAAyB,CAC7B,OAAQe,EAAgBhB,EAAO,OAAO,EACtC,IAAK,GACL,WAAY,GACZ,WAAY,EAAA,EAGRkB,EAAS,IAAM,CACnBC,EAAOpB,EAASC,EAAQC,CAAK,EAAGQ,CAAK,EAE/B,MAAAW,EAAcX,EAAM,cAAgC,sBAAsB,EAC1EY,EAAaZ,EAAM,cAAgC,qBAAqB,EACxEa,EAAWb,EAAM,cAAgC,yBAAyB,EAC1Ec,EAAYd,EAAM,cAAiC,mBAAmB,EAExEW,GACUA,EAAA,iBAAiB,QAAUI,GAAU,CAC/C,MAAMC,EAASD,EAAM,OACfpC,EAAQ,OAAOqC,EAAO,KAAK,EAC5B,OAAO,SAASrC,CAAK,IACpBa,EAAA,OAASe,EAAgB5B,CAAK,EAC7B8B,IAAA,CACR,EAGCG,GACSA,EAAA,iBAAiB,QAAUG,GAAU,CAC9C,MAAMC,EAASD,EAAM,OACfpC,EAAQ,OAAOqC,EAAO,KAAK,EAC5B,OAAO,SAASrC,CAAK,IACpBa,EAAA,OAASe,EAAgB5B,CAAK,EAC7B8B,IAAA,CACR,EAGCI,IACOA,EAAA,iBAAiB,QAAUE,GAAU,CAC5C,MAAMC,EAASD,EAAM,OACfvB,EAAA,IAAMwB,EAAO,MAAM,YAAY,EAC9BP,GAAA,CACR,EAEQI,EAAA,iBAAiB,OAAQ,IAAM,CACtCrB,EAAM,WAAa,GACZiB,GAAA,CACR,GAGCK,GACQA,EAAA,iBAAiB,QAAS,IAAM,CAClC,MAAAG,EAAczB,EAAM,OAAShB,EAC7B0C,EAAWzC,EAAU,KAAKe,EAAM,GAAG,EACrC,GAAAyB,GAAe,CAACC,EAAU,CAC5B1B,EAAM,WAAa,GACZiB,IACP,MACF,CACAjB,EAAM,WAAa,GACZiB,GAAA,CACR,CACH,EAGFU,EAAanB,CAAK,EACXS,GACT"}