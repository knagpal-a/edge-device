import{t as T}from"../__chunks__/toCamelCase.fmNGsVmq.js";import{t as O}from"../__chunks__/toClassName.DLENMWzL.js";function u(e,n){const i=document.createElement(e);return n&&(i.className=n),i}function m(e,n=null){const i=T(e);return n?`${i}-${T(n)}`:i}function w(e,n){const i=u("p","field-help-text");return i.textContent=e,i.id=`${n}-help`,i}function g(e,n="label",i=null,t=!1){const s=u(n);return s.textContent=e,i&&n==="label"&&s.setAttribute("for",i),t&&(s.dataset.required="true"),s}function R(e){const{type:n,field:i,required:t,default:s,placeholder:o}=e,r=u("input");return r.type=n||"text",r.id=m(i||"field"),r.name=r.id,r.required=t==="true",s&&(r.value=s),o&&(r.placeholder=o),r}function _(e){const{field:n,required:i,default:t,placeholder:s}=e,o=u("textarea");return o.id=m(n||"field"),o.name=o.id,o.required=i==="true",o.rows=5,t&&(o.value=t),s&&(o.placeholder=s),o}function V(e,n){const{type:i,field:t,default:s,required:o}=e,r=m(t||"field",n),l=u("input");return l.type=i||"text",l.id=r,l.name=m(t||"field"),l.value=n,l.checked=n===s,l.required=o==="true",l}function F(e,n){const{type:i,options:t,label:s,required:o}=e;if(!t)return null;const r=u("fieldset",`form-field ${i}-field`);if(n){const l=n.split("-")[0];r.dataset.controller=l,r.dataset.condition=n}return r.append(g(s||"","legend",null,o==="true")),t.split(",").forEach(l=>{const a=l.trim(),c=V(e,a),d=u("span"),f=g(a,"label",c.id);f.prepend(c,d),r.append(f)}),r}async function k(e){const n=await fetch(e),{data:i}=await n.json();return i.map(s=>{const{option:o,value:r}=s,l=u("option");return o&&r?(l.value=r,l.textContent=o):o&&!r?(l.value=o,l.textContent=o):r&&!o&&(l.value=r,l.textContent=r),l})}function M(e,n){const{type:i,options:t,field:s,label:o,required:r,placeholder:l}=e;if(!t)return null;const a=u("div",`form-field ${i||"text"}-field`);if(n){const d=n.split("-")[0];a.dataset.controller=d,a.dataset.condition=n}a.append(g(o||"","label",m(s||"field"),r==="true"));const c=u("select");if(c.id=m(s||"field"),c.name=c.id,c.required=r==="true",a.append(c),l){const d=u("option");d.value="",d.textContent=l,d.disabled=!0,d.selected=!0,c.append(d)}try{const d=new URL(t);k(d).then(f=>{c.append(...f)})}catch{t.split(",").forEach(f=>{const p=f.trim(),b=u("option");b.value=p,b.textContent=p,c.append(b)})}return a}function P(e,n){const{label:i,required:t,default:s}=e,o=u("div","form-field toggle-field");if(n){const c=n.split("-")[0];o.dataset.controller=c,o.dataset.condition=n}const r=V({...e,type:"checkbox"},s||"true");r.setAttribute("role","switch"),r.setAttribute("aria-checked",String(r.checked)),r.addEventListener("change",()=>{r.setAttribute("aria-checked",String(r.checked))});const l=u("span"),a=g(i||"","label",r.id,t==="true");return a.prepend(r,l),o.append(a),o}function B(e){const{type:n,label:i}=e,t=u("button");return t.className="button",t.type=n||"button",t.textContent=i||"",n==="reset"&&t.classList.add("secondary"),t}function U(e,n){const{target:i}=e,t=i.name;n.has(t)&&[...n.get(t)||[]].forEach(o=>{const r=o.closest(".form-field"),{condition:l}=r.dataset,a=l?l.includes(O(i.value)):!1;r.setAttribute("aria-hidden",String(!a)),a?(o.dataset.originalRequired==="true"&&o.setAttribute("required",""),o.removeAttribute("tabindex")):(o.removeAttribute("required"),o.setAttribute("tabindex","-1"))})}function j(e,n){n.forEach((i,t)=>{let s=null;const o=e.querySelector(`[name="${t}"]:checked`),r=e.querySelector(`select[name="${t}"]`);if(o?s=o.value:r&&(s=r.value),s){const l=s;i.forEach(a=>{const c=a.closest(".form-field"),{condition:d}=c.dataset,f=d?d.includes(O(l)):!1;c.setAttribute("aria-hidden",String(!f)),a.hasAttribute("required")&&(a.dataset.originalRequired||(a.dataset.originalRequired="true"),f||a.removeAttribute("required")),f?a.removeAttribute("tabindex"):a.setAttribute("tabindex","-1")})}else i.forEach(l=>{l.closest(".form-field").setAttribute("aria-hidden","true"),l.hasAttribute("required")&&(l.dataset.originalRequired||(l.dataset.originalRequired="true"),l.removeAttribute("required")),l.setAttribute("tabindex","-1")})})}function W(e){const n=[...e.querySelectorAll("[data-controller]")],i=new Map;n.forEach(t=>{const s=t.querySelector("input, textarea, select"),{controller:o}=t.dataset;s&&o&&(i.has(o)||i.set(o,[]),(i.get(o)||[]).push(s),s&&s.id&&e.querySelectorAll(`[name="${o}"]`).forEach(l=>{const c=(l.getAttribute("aria-controls")||"").split(" ").filter(d=>d);c.includes(s.id)||c.push(s.id),l.setAttribute("aria-controls",c.join(" ")),s.setAttribute("aria-controlledby",l.id)}))}),j(e,i),e.addEventListener("change",t=>{U(t,i)})}function I(e){const{type:n,label:i,help:t,field:s,conditional:o}=e,r=o||null,l=s||"field";if(n==="hidden")return R(e);if(n==="submit"||n==="reset")return B(e);if(n==="radio"||n==="checkbox"){const p=F(e,r);if(p&&t){const b=w(t,m(l));p.append(b)}return p||u("div")}if(n==="toggle"){const p=P(e,r);if(t){const b=w(t,m(l));p.append(b)}return p}if(n==="select"){const p=M(e,r);if(p&&t){const b=w(t,m(l));p.append(b)}return p||u("div")}const a=u("div",`form-field ${n}-field`);if(r){const p=r.split("-")[0];a.dataset.controller=p,a.dataset.condition=r}const c=m(l);a.append(g(i||"","label",c,e.required==="true"));let d;t&&(d=w(t,c),a.append(d));const f=n==="textarea"?_(e):R(e);return n==="textarea"?a.append(f):a.firstChild?a.insertBefore(f,a.firstChild.nextSibling):a.append(f),d&&f.setAttribute("aria-describedby",d.id),a}function D(e,n){const i=u("form");i.setAttribute("novalidate","");const t=[];if(e.forEach(s=>{s.type==="submit"||s.type==="reset"?t.push(s):s.type!=="confirmation"&&i.append(I(s))}),t.length){const s=u("div","button-wrapper");t.forEach(o=>s.append(I(o))),i.append(s)}return W(i),i}function H(e,n,i=""){const t=e.find(s=>s.field===n);return t?t.default?t.default:t.value?t.value:i:i}function z(e,n){const i="otp",o=H(n,"resendLimitMessage","Resend OTP limit exhausted."),r="Resend OTP",l="Resend available in",a="/thank-you",c="Invalid OTP. Please try again.",d=e.querySelector(`input[name="${T(i)}"]`);if(!d)return;const f=d.closest(".form-field");if(!f)return;const p=u("div","otp-resend"),b=u("div","otp-resend__loader"),S=u("span","otp-resend__loader-text"),L=u("span","otp-resend__timer");b.append(S,L);const v=u("button","otp-resend__button");v.type="button",v.textContent=r;const A=u("div","otp-resend__message");A.textContent=o,p.append(b,v,A),f.append(p);const x=u("div","otp-verify__message");x.textContent=c,x.style.display="none",f.append(x);let $=0,q;const C=h=>{b.style.display=h==="loading"?"flex":"none",v.style.display=h==="ready"?"inline-flex":"none",A.style.display=h==="limit"?"block":"none"},N=h=>{let E=Number.isFinite(h)?h:0;S.textContent=l,C("loading");const y=()=>{L.textContent=` ${E}s`,E<=0&&(q!==void 0&&window.clearInterval(q),q=void 0,C("ready")),E-=1};y(),q=window.setInterval(y,1e3)};N(30),v.addEventListener("click",()=>{if($+=1,$>3){C("limit");return}e.dispatchEvent(new CustomEvent("otp:resend",{bubbles:!0})),N(30)}),e.addEventListener("submit",()=>{d&&d.checkValidity()}),e.addEventListener("submit",h=>{if(h.preventDefault(),x.style.display="none",!e.reportValidity()){const y=e.querySelector(":invalid:not(fieldset)");y&&(y.focus(),y.scrollIntoView({behavior:"smooth",block:"center"}),y.setAttribute("aria-invalid","true"));return}d.value==="12345"?window.location.href=a:(x.style.display="block",d.focus())})}function K(e){e.style.visibility="hidden";const n=[...e.querySelectorAll("a[href]")],[i]=n.map(t=>t.href);if(i){const t=new IntersectionObserver(s=>{s.forEach(async o=>{if(o.isIntersecting){try{const r=await fetch(new URL(i,window.location.origin));if(!r.ok)throw new Error(`${r.status}: ${r.statusText}`);const{data:l}=await r.json();if(!l)throw new Error(`No form fields at ${i}`);const c=D([{field:"firstName",type:"text",label:"First name",placeholder:"Enter first name",required:"true"},{field:"lastName",type:"text",label:"Last name",placeholder:"Enter last name",required:"true"},{field:"mobile",type:"tel",label:"Mobile number",placeholder:"Enter mobile number",required:"true"},{field:"otp",type:"text",label:"OTP",placeholder:"Enter OTP",required:"true"},{field:"submit",type:"submit",label:"Verify OTP"}]);z(c,l),e.replaceChildren(c),e.removeAttribute("style")}catch(r){console.error("Could not build form from",i,r),e.parentElement&&e.parentElement.remove()}t.disconnect()}})},{threshold:0});t.observe(e)}else console.error("Unable to create form without source"),e.parentElement&&e.parentElement.remove()}export{K as default};
//# sourceMappingURL=form.js.map
