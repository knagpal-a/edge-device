import{t as L}from"../__chunks__/toCamelCase.fmNGsVmq.js";import{t as _}from"../__chunks__/toClassName.DLENMWzL.js";function u(e,t){const r=document.createElement(e);return t&&(r.className=t),r}function h(e,t=null){const r=L(e);return t?`${r}-${L(t)}`:r}function S(e,t){const r=u("p","field-help-text");return r.textContent=e,r.id=`${t}-help`,r}function q(e,t="label",r=null,n=!1){const l=u(t);return l.textContent=e,r&&t==="label"&&l.setAttribute("for",r),n&&(l.dataset.required="true"),l}function F(e){const{type:t,field:r,required:n,default:l,placeholder:i,pattern:s,maxlength:o,inputmode:a}=e,d=u("input");return d.type=t||"text",d.id=h(r||"field"),d.name=d.id,d.required=n==="true",l&&(d.value=l),i&&(d.placeholder=i),s&&(d.pattern=s),o&&(d.maxLength=Number(o)),a&&(d.inputMode=a),d}function M(e){const{field:t,required:r,default:n,placeholder:l}=e,i=u("textarea");return i.id=h(t||"field"),i.name=i.id,i.required=r==="true",i.rows=5,n&&(i.value=n),l&&(i.placeholder=l),i}function I(e,t){const{type:r,field:n,default:l,required:i}=e,s=h(n||"field",t),o=u("input");return o.type=r||"text",o.id=s,o.name=h(n||"field"),o.value=t,o.checked=t===l,o.required=i==="true",o}function P(e,t){const{type:r,options:n,label:l,required:i}=e;if(!n)return null;const s=u("fieldset",`form-field ${r}-field`);if(t){const o=t.split("-")[0];s.dataset.controller=o,s.dataset.condition=t}return s.append(q(l||"","legend",null,i==="true")),n.split(",").forEach(o=>{const a=o.trim(),d=I(e,a),c=u("span"),p=q(a,"label",d.id);p.prepend(d,c),s.append(p)}),s}async function B(e){const t=await fetch(e),{data:r}=await t.json();return r.map(l=>{const{option:i,value:s}=l,o=u("option");return i&&s?(o.value=s,o.textContent=i):i&&!s?(o.value=i,o.textContent=i):s&&!i&&(o.value=s,o.textContent=s),o})}function j(e,t){const{type:r,options:n,field:l,label:i,required:s,placeholder:o}=e;if(!n)return null;const a=u("div",`form-field ${r||"text"}-field`);if(t){const c=t.split("-")[0];a.dataset.controller=c,a.dataset.condition=t}a.append(q(i||"","label",h(l||"field"),s==="true"));const d=u("select");if(d.id=h(l||"field"),d.name=d.id,d.required=s==="true",a.append(d),o){const c=u("option");c.value="",c.textContent=o,c.disabled=!0,c.selected=!0,d.append(c)}try{const c=new URL(n);B(c).then(p=>{d.append(...p)})}catch{n.split(",").forEach(p=>{const f=p.trim(),b=u("option");b.value=f,b.textContent=f,d.append(b)})}return a}function D(e,t){const{label:r,required:n,default:l}=e,i=u("div","form-field toggle-field");if(t){const d=t.split("-")[0];i.dataset.controller=d,i.dataset.condition=t}const s=I({...e,type:"checkbox"},l||"true");s.setAttribute("role","switch"),s.setAttribute("aria-checked",String(s.checked)),s.addEventListener("change",()=>{s.setAttribute("aria-checked",String(s.checked))});const o=u("span"),a=q(r||"","label",s.id,n==="true");return a.prepend(s,o),i.append(a),i}function U(e){const{type:t,label:r}=e,n=u("button");return n.className="button",n.type=t||"button",n.textContent=r||"",t==="reset"&&n.classList.add("secondary"),n}function W(e,t){const{target:r}=e,n=r.name;t.has(n)&&[...t.get(n)||[]].forEach(i=>{const s=i.closest(".form-field"),{condition:o}=s.dataset,a=o?o.includes(_(r.value)):!1;s.setAttribute("aria-hidden",String(!a)),a?(i.dataset.originalRequired==="true"&&i.setAttribute("required",""),i.removeAttribute("tabindex")):(i.removeAttribute("required"),i.setAttribute("tabindex","-1"))})}function H(e,t){t.forEach((r,n)=>{let l=null;const i=e.querySelector(`[name="${n}"]:checked`),s=e.querySelector(`select[name="${n}"]`);if(i?l=i.value:s&&(l=s.value),l){const o=l;r.forEach(a=>{const d=a.closest(".form-field"),{condition:c}=d.dataset,p=c?c.includes(_(o)):!1;d.setAttribute("aria-hidden",String(!p)),a.hasAttribute("required")&&(a.dataset.originalRequired||(a.dataset.originalRequired="true"),p||a.removeAttribute("required")),p?a.removeAttribute("tabindex"):a.setAttribute("tabindex","-1")})}else r.forEach(o=>{o.closest(".form-field").setAttribute("aria-hidden","true"),o.hasAttribute("required")&&(o.dataset.originalRequired||(o.dataset.originalRequired="true"),o.removeAttribute("required")),o.setAttribute("tabindex","-1")})})}function z(e){const t=[...e.querySelectorAll("[data-controller]")],r=new Map;t.forEach(n=>{const l=n.querySelector("input, textarea, select"),{controller:i}=n.dataset;l&&i&&(r.has(i)||r.set(i,[]),(r.get(i)||[]).push(l),l&&l.id&&e.querySelectorAll(`[name="${i}"]`).forEach(o=>{const d=(o.getAttribute("aria-controls")||"").split(" ").filter(c=>c);d.includes(l.id)||d.push(l.id),o.setAttribute("aria-controls",d.join(" ")),l.setAttribute("aria-controlledby",o.id)}))}),H(e,r),e.addEventListener("change",n=>{W(n,r)})}function R(e){const{type:t,label:r,help:n,field:l,conditional:i}=e,s=i||null,o=l||"field";if(t==="hidden")return F(e);if(t==="submit"||t==="reset")return U(e);if(t==="radio"||t==="checkbox"){const f=P(e,s);if(f&&n){const b=S(n,h(o));f.append(b)}return f||u("div")}if(t==="toggle"){const f=D(e,s);if(n){const b=S(n,h(o));f.append(b)}return f}if(t==="select"){const f=j(e,s);if(f&&n){const b=S(n,h(o));f.append(b)}return f||u("div")}const a=u("div",`form-field ${t}-field`);if(s){const f=s.split("-")[0];a.dataset.controller=f,a.dataset.condition=s}const d=h(o);a.append(q(r||"","label",d,e.required==="true"));let c;n&&(c=S(n,d),a.append(c));const p=t==="textarea"?M(e):F(e);return t==="textarea"?a.append(p):a.firstChild?a.insertBefore(p,a.firstChild.nextSibling):a.append(p),c&&p.setAttribute("aria-describedby",c.id),a}function G(e,t){const r=u("form");r.setAttribute("novalidate","");const n=[];if(e.forEach(l=>{l.type==="submit"||l.type==="reset"?n.push(l):l.type!=="confirmation"&&r.append(R(l))}),n.length){const l=u("div","button-wrapper");n.forEach(i=>l.append(R(i))),r.append(l)}return z(r),r}function J(e,t,r=""){const n=e.find(l=>l.field===t);return n?n.default?n.default:n.value?n.value:r:r}function K(e,t){const r="otp",i=J(t,"resendLimitMessage","Resend OTP limit exhausted."),s="Resend OTP",o="Resend available in",a="/thank-you",d="Invalid OTP. Please try again.",c=e.querySelector(`input[name="${L(r)}"]`);if(!c)return;const p=e.querySelector('input[name="mobile"]'),f=c.closest(".form-field");if(!f)return;const b=u("div","otp-resend"),A=u("div","otp-resend__loader"),k=u("span","otp-resend__loader-text"),N=u("span","otp-resend__timer");A.append(k,N);const v=u("button","otp-resend__button");v.type="button",v.textContent=s;const C=u("div","otp-resend__message");C.textContent=i,b.append(A,v,C),f.append(b);const x=u("div","otp-verify__message");x.textContent=d,x.style.display="none",f.append(x);let O=0,E,V=!1;const T=m=>{A.style.display=m==="loading"?"flex":"none",v.style.display=m==="ready"?"inline-flex":"none",C.style.display=m==="limit"?"block":"none"},$=()=>{A.style.display="none",v.style.display="none",C.style.display="none"},w=m=>{if(V)return;V=!0;let g=Number.isFinite(m)?m:0;k.textContent=o,T("loading");const y=()=>{N.textContent=` ${g}s`,g<=0&&(E!==void 0&&window.clearInterval(E),E=void 0,T("ready")),g-=1};y(),E=window.setInterval(y,1e3)};if($(),p){const m=()=>{p.value.replace(/\D/g,"").length>=10&&w(30)};p.addEventListener("input",m),m()}else w(30);v.addEventListener("click",()=>{if(O+=1,O>3){T("limit");return}e.dispatchEvent(new CustomEvent("otp:resend",{bubbles:!0})),w(30)}),e.addEventListener("submit",()=>{c&&c.checkValidity()}),e.addEventListener("submit",m=>{if(m.preventDefault(),x.style.display="none",!e.reportValidity()){const y=e.querySelector(":invalid:not(fieldset)");y&&(y.focus(),y.scrollIntoView({behavior:"smooth",block:"center"}),y.setAttribute("aria-invalid","true"));return}c.value==="12345"?window.location.href=a:(x.style.display="block",c.focus())})}function Y(e){e.style.visibility="hidden";const t=[];e.querySelectorAll("tr").forEach(l=>{var s,o;const i=l.querySelectorAll("td, th");if(i.length>=2){const a=((s=i[0].textContent)==null?void 0:s.trim())||"",d=((o=i[1].textContent)==null?void 0:o.trim())||"";a&&t.push({field:a,type:"hidden",default:d})}});const n=G([{field:"firstName",type:"text",label:"First name",placeholder:"Enter first name",required:"true"},{field:"lastName",type:"text",label:"Last name",placeholder:"Enter last name",required:"true"},{field:"mobile",type:"tel",label:"Mobile number",placeholder:"Enter mobile number",required:"true",inputmode:"numeric",maxlength:"10",pattern:"\\\\d{10}"},{field:"otp",type:"text",label:"OTP",placeholder:"Enter OTP",required:"true"},{field:"submit",type:"submit",label:"Verify OTP"}]);K(n,t),e.replaceChildren(n),e.removeAttribute("style")}export{Y as default};
//# sourceMappingURL=form.js.map
